# SMA-Q2-Arduino
  SMA-Q2 / SMA-TIME test firmware
  You can program the SMA-Q2 via the Arduino IDE easily by installing the Adafruit nrf52 core,
  which also contains an older version of the nrfutil (0.5.2 in the case of core version 0.8.5).
  
  This raw sketch demonstrates some basic functions of the watch hardware such as ultra low power mode of the nrf52832, 
  the RTC, the display library, battery voltage measurement,
  basic BLE peripheral functionality, watchdog feeding, backlight etc...
  The accelerometer and heart rate sensor are not working yet.
 
  See https://hackaday.io/project/85463-color-open-source-smartwatch for pinout
    
  Change the pins in variant.h 
  (C:\Users\[....]\AppData\Local\Arduino15\packages\adafruit\hardware\nrf52\0.8.5\variants\feather52) file accordingly 
  (SPI depicted only)
  
  #define PIN_SPI_MISO         (11) //14
  #define PIN_SPI_MOSI         (3) //13
  #define PIN_SPI_SCK          (2) //12

  
  With the following nrfutil commands you can generate the .zip files for OTA DFU from
  .hex files the Arduino IDE produces if you go to "Sketch->Export compiled binary"
  (I'm working under windows):
  C:\Users\[.....]\AppData\Local\Arduino15\packages\adafruit\hardware\nrf52\0.8.5\tools\nrfutil-0.5.2\binaries\win32\nrfutil
  dfu genpkg --application C:\Users\[.....]\Documents\Arduino\\SMAQ2_FW1\SMAQ2_FW1.ino.feather52.hex
  --sd-req 0x88 C:\Users\[.....]\Documents\Arduino\SMAQ2_FW1\SMAQ2_FW1.zip

  The --sd-req 0x88 stands for s132 2.0.1 on nRF52
  0.8.5 is supposed to be the last core version supporting 2.0.1 softdevice.
  
  Once in DFU mode the .zip file generated by nrfutil can be fed into the DFU tool of the "nRF Toolbox" Android app to program the    device over the air.


  With the original firmware, you enter the DFU mode of the watch by pressing the "back" as well as the "up"
  and "down" buttons simultaneously (a little acrobatic) when the watch powered off.
  Alternatively press this button combo and reset the thing (by pulling the rst testpad (P0.21) to ground with a reed switch) or power-cycling it.
  You should see a "DFU mode" screen with a progress bar.
  
  With custom firmware the MCU also checks for the bootloader button combo as it gets out of systemOff(BTN_UP, LOW); //name any pin and wakeup logic here 
   So in the above example you press up and down first, and the BTN_UP last to enter DFU mode. 
